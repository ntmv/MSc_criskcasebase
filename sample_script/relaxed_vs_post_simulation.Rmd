---
title: "Relaxed Lasso Glmnet Simulation"
author: "Alexander Romanus"
date: "`r Sys.Date()`"
output:
  html_document: 
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
library(casebase)
library(future.apply)
library(glmnet)
#library(mtool)
library(parallelly)
library(timereg)
library(parallel)
library(tictoc)
library(tidyverse)
#library(riskRegression)
library(cmprsk)
library(survsim)
library(caret)
library(Matrix)
library(dplyr)

# Helper functions 
source("src/helper_functions.R")
```

``` {r practice, warning = FALSE, echo = FALSE}
# p = 20
# n = 400
# 
# dataset = generateDataset(p, n)
# partitioned_data = partitionData(dataset$X, dataset$Y)
# training_data = partitioned_data[c("x_train", "y_train")]
# 
# res = myRelaxedGlmnetFolds(training_data$x_train, training_data$y_train, folds = 5, TRUE)
# 
# resulting_fits = fitAll(training_data$x_train, training_data$y_train, FALSE)
# 
# # Get table of coefficient values for each model
# coefficient_names = colnames(as.data.frame(training_data$x_train))
# coefficient_names = c("Model", coefficient_names)
# coefs = formatCoefficientTable(p, n, coefficient_names, resulting_fits, print_time)
# 
# # Compute biases
# MSEs = computeMSEs(resulting_fits, test_data)
# result = list(coefficient_table = coefs, MSE_table = MSEs)
```


# Run simulation
``` {r run-sim, warning = FALSE, echo = FALSE}
N = 1000
tic()
sim_results = runSim(20, 400, N, FALSE)
cat(paste("Time to compute ", as.character(N), " iterations: ", toc()))
```


# Results from N = 1000 simulation

## Coefficient Biases

``` {r resulting-coefficients, echo=FALSE}
formatCoefficientBiasTable(sim_results)
```

## Average Test MSEs

``` {r resulting-MSEs, echo=FALSE}
formatAverageTestMSETable(sim_results)
```

# CV MSE plot by log lambda

``` {r relaxed-lasso-glmnet-cv-results, echo=FALSE, eval = FALSE}
par(mfrow = c(1, 1), mar = c(2, 4, 6, 4))
plot(fit_Y1, main = "relax = FALSE, LASSO")
plot(relaxed_fit_Y1, main = "relax = TRUE")
```

